{% extends 'base.html' %}

{% block title %}Transaction History - ATM Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="history-header">
        <h1>Transaction History</h1>
        <div class="filter-section">
            <form method="get" class="filter-form">
                <select name="type" class="form-control" onchange="this.form.submit()">
                    <option value="">All Transactions</option>
                    <option value="DEPOSIT" {% if request.GET.type == 'DEPOSIT' %}selected{% endif %}>Deposits</option>
                    <option value="WITHDRAWAL" {% if request.GET.type == 'WITHDRAWAL' %}selected{% endif %}>Withdrawals</option>
                    <option value="TRANSFER" {% if request.GET.type == 'TRANSFER' %}selected{% endif %}>Transfers</option>
                    <option value="BALANCE_INQUIRY" {% if request.GET.type == 'BALANCE_INQUIRY' %}selected{% endif %}>Balance Inquiries</option>
                </select>
            </form>
        </div>
    </div>

    <div class="account-info-bar">
        <p><strong>Account:</strong> {{ account.account_number }}</p>
        <p><strong>Current Balance:</strong> â‚¹{{ account.balance|floatformat:2 }}</p>
    </div>

    {% if transactions %}
    <div class="transactions-table">
        <table>
            <thead>
                <tr>
                    <th>Transaction ID</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Balance Before</th>
                    <th>Balance After</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.transaction_id }}</td>
                    <td>
                        <span class="badge badge-{{ transaction.transaction_type|lower }}">
                            {{ transaction.get_transaction_type_display }}
                        </span>
                    </td>
                    <td class="{% if transaction.transaction_type == 'DEPOSIT' %}text-success{% elif transaction.transaction_type != 'BALANCE_INQUIRY' %}text-danger{% endif %}">
                        {% if transaction.transaction_type == 'DEPOSIT' %}+{% elif transaction.transaction_type != 'BALANCE_INQUIRY' %}-{% endif %}â‚¹{{ transaction.amount|floatformat:2 }}
                    </td>
                    <td>â‚¹{{ transaction.balance_before|floatformat:2 }}</td>
                    <td>â‚¹{{ transaction.balance_after|floatformat:2 }}</td>
                    <td>{{ transaction.description|truncatewords:15 }}</td>
                    <td>
                        <span class="badge badge-status-{{ transaction.status|lower }}">
                            {{ transaction.status }}
                        </span>
                    </td>
                    <td>{{ transaction.created_at|date:"M d, Y H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ðŸ“­</div>
        <h2>No Transactions</h2>
        <p>You don't have any transactions yet.</p>
        <a href="{% url 'dashboard' %}" class="btn btn-primary">Back to Dashboard</a>
    </div>
    {% endif %}
</div>
{% endblock %}
